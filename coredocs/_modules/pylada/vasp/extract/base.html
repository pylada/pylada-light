

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pylada.vasp.extract.base &mdash; Pylada-light 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="author" title="About these documents" href="../../../../about.html" />
    <link rel="top" title="Pylada-light 1.0 documentation" href="../../../../index.html" />
    <link rel="up" title="pylada.vasp.extract" href="../extract.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">Pylada-light 1.0 documentation</a> &raquo;</li>
          <li><a href="../../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../../pylada.html" >pylada</a> &raquo;</li>
          <li><a href="../../vasp.html" >pylada.vasp</a> &raquo;</li>
          <li><a href="../extract.html" accesskey="U">pylada.vasp.extract</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pylada.vasp.extract.base</h1><div class="highlight"><pre>
<span class="c">###############################</span>
<span class="c">#  This file is part of PyLaDa.</span>
<span class="c">#</span>
<span class="c">#  Copyright (C) 2013 National Renewable Energy Lab</span>
<span class="c"># </span>
<span class="c">#  PyLaDa is a high throughput computational platform for Physics. It aims to make it easier to submit</span>
<span class="c">#  large numbers of jobs on supercomputers. It provides a python interface to physical input, such as</span>
<span class="c">#  crystal structures, as well as to a number of DFT (VASP, CRYSTAL) and atomic potential programs. It</span>
<span class="c">#  is able to organise and launch computational jobs on PBS and SLURM.</span>
<span class="c"># </span>
<span class="c">#  PyLaDa is free software: you can redistribute it and/or modify it under the terms of the GNU General</span>
<span class="c">#  Public License as published by the Free Software Foundation, either version 3 of the License, or (at</span>
<span class="c">#  your option) any later version.</span>
<span class="c"># </span>
<span class="c">#  PyLaDa is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even</span>
<span class="c">#  the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General</span>
<span class="c">#  Public License for more details.</span>
<span class="c"># </span>
<span class="c">#  You should have received a copy of the GNU General Public License along with PyLaDa.  If not, see</span>
<span class="c">#  &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="c">###############################</span>

<span class="sd">&quot;&quot;&quot; Subpackage containing extraction methods for VASP. &quot;&quot;&quot;</span>
<span class="n">__docformat__</span>  <span class="o">=</span> <span class="s">&#39;restructuredtext en&#39;</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;ExtractBase&#39;</span><span class="p">]</span>
<span class="kn">from</span> <span class="nn">quantities</span> <span class="kn">import</span> <span class="n">g</span><span class="p">,</span> <span class="n">cm</span><span class="p">,</span> <span class="n">eV</span>
<span class="kn">from</span> <span class="nn">...tools</span> <span class="kn">import</span> <span class="n">make_cached</span>
<span class="kn">from</span> <span class="nn">...tools.extract</span> <span class="kn">import</span> <span class="n">search_factory</span>
<span class="kn">from</span> <span class="nn">...error</span> <span class="kn">import</span> <span class="n">GrepError</span>
<span class="kn">from</span> <span class="nn">pylada.misc</span> <span class="kn">import</span> <span class="n">bugLev</span>


<span class="n">OutcarSearchMixin</span> <span class="o">=</span> <span class="n">search_factory</span><span class="p">(</span><span class="s">&#39;OutcarSearchMixin&#39;</span><span class="p">,</span> <span class="s">&#39;OUTCAR&#39;</span><span class="p">,</span> <span class="n">__name__</span><span class="p">)</span>

<div class="viewcode-block" id="ExtractBase"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase">[docs]</a><span class="k">class</span> <span class="nc">ExtractBase</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot; Implementation class for extracting data from VASP output &quot;&quot;&quot;</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Initializes the extraction class. &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">pylada.misc</span> <span class="kn">import</span> <span class="n">bugLev</span>

    <span class="k">if</span> <span class="n">bugLev</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;vasp/extract/base: ExtractBase: object: &#39;</span><span class="p">,</span> <span class="nb">object</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">ExtractBase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.ialgo"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.ialgo">[docs]</a>  <span class="k">def</span> <span class="nf">ialgo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns the kind of algorithms. &quot;&quot;&quot;</span>
    <span class="c"># Look for line like:    IALGO  =     68    algorithm</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;^\s*IALGO\s*=\s*(\d+)\s*&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.algo"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.algo">[docs]</a>  <span class="k">def</span> <span class="nf">algo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns the kind of algorithms. &quot;&quot;&quot;</span>
    <span class="c"># This could be gotten in OUTCAR: use the 1 occurance of:</span>
    <span class="c">#   ALGO = Fast</span>
    <span class="k">return</span> <span class="p">{</span> <span class="mi">68</span><span class="p">:</span> <span class="s">&#39;Fast&#39;</span><span class="p">,</span> <span class="mi">38</span><span class="p">:</span> <span class="s">&#39;Normal&#39;</span><span class="p">,</span> <span class="mi">48</span><span class="p">:</span> <span class="s">&#39;Very Fast&#39;</span><span class="p">,</span> <span class="mi">58</span><span class="p">:</span> <span class="s">&#39;Conjugate&#39;</span><span class="p">,</span>
             <span class="mi">53</span><span class="p">:</span> <span class="s">&#39;Damped&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="s">&#39;Subrot&#39;</span><span class="p">,</span> <span class="mi">90</span><span class="p">:</span> <span class="s">&#39;Exact&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s">&#39;Nothing&#39;</span><span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">ialgo</span><span class="p">]</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ExtractBase.is_dft"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.is_dft">[docs]</a>  <span class="k">def</span> <span class="nf">is_dft</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; True if this is a DFT calculation, as opposed to GW. &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">algo</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;gw&#39;</span><span class="p">,</span> <span class="s">&#39;gw0&#39;</span><span class="p">,</span> <span class="s">&#39;chi&#39;</span><span class="p">,</span> <span class="s">&#39;scgw&#39;</span><span class="p">,</span> <span class="s">&#39;scgw0&#39;</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">return</span> <span class="bp">False</span>

  <span class="c"># fixmod:</span>
  <span class="c"># Caution: I don&#39;t think the following will work,</span>
  <span class="c"># as self.algo, as set by algo() above, will never be *gw*.</span></div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ExtractBase.is_gw"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.is_gw">[docs]</a>  <span class="k">def</span> <span class="nf">is_gw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; True if this is a GW calculation, as opposed to DFT. &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">algo</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;gw&#39;</span><span class="p">,</span> <span class="s">&#39;gw0&#39;</span><span class="p">,</span> <span class="s">&#39;chi&#39;</span><span class="p">,</span> <span class="s">&#39;scgw&#39;</span><span class="p">,</span> <span class="s">&#39;scgw0&#39;</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">return</span> <span class="bp">False</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ExtractBase.encut"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.encut">[docs]</a>  <span class="k">def</span> <span class="nf">encut</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Energy cutoff. &quot;&quot;&quot;</span>
    <span class="c"># OUTCAR: use the first occurance of:</span>
    <span class="c">#   ENCUT  =  252.0 eV  18.52 Ry  ...</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;ENCUT\s*=\s*(\S+)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">eV</span>


</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.functional"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.functional">[docs]</a>  <span class="k">def</span> <span class="nf">functional</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns vasp functional used for calculation.</span>


<span class="sd">        The vasp functional is the python object used to generate the OUTCAR</span>
<span class="sd">        over which this extraction object acts. Pylada pastes a representation</span>
<span class="sd">        of the functional at the end of the OUTCAR. This is what is extracted.</span>
<span class="sd">        Hence this attribute will work only on OUTCAR&#39;s generated by Pylada.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">Vasp</span>
    <span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="nb">compile</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">exec_input</span>

    <span class="c"># nomodoutcar</span>
    <span class="c">#regex = compile(&#39;#+ FUNCTIONAL #+\n((.|\n)*)\n#+ END FUNCTIONAL #+&#39;)</span>
    <span class="c">#with self.__outcar__() as file: result = regex.search(file.read())</span>
    <span class="c">#if result is None: return None</span>

    <span class="n">funPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="s">&#39;pylada.FUNCTIONAL&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span> <span class="n">funPath</span><span class="p">)</span> <span class="k">as</span> <span class="n">fin</span><span class="p">:</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">fin</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="c"># Bad hack. Some derived object will have different names...</span>
    <span class="c"># Hopefully, there shouldn&#39;t be too many objects and this should be fairly</span>
    <span class="c"># fast.</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">exec_input</span><span class="p">(</span> <span class="n">result</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">bugLev</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&#39;extract/base functional: ===== start result&#39;</span>
      <span class="k">print</span> <span class="n">result</span>
      <span class="k">print</span> <span class="s">&#39;extract/base functional: ===== end result&#39;</span>
      <span class="k">print</span> <span class="s">&#39;extract/base functional: ===== start input&#39;</span>
      <span class="k">print</span> <span class="nb">input</span>
      <span class="k">print</span> <span class="s">&#39;extract/base functional: ===== end input&#39;</span>
      <span class="k">print</span> <span class="s">&#39;extract/base functional: ===== start input.vasp&#39;</span>
      <span class="k">print</span> <span class="nb">input</span><span class="o">.</span><span class="n">vasp</span>
      <span class="k">print</span> <span class="s">&#39;extract/base functional: ===== end input.vasp&#39;</span>

    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span> <span class="n">Vasp</span><span class="p">):</span> <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="c"># otherwise, just try the objvious. but it really should fail at this</span>
    <span class="c"># point.</span>
    <span class="k">return</span> <span class="nb">input</span><span class="o">.</span><span class="n">vasp</span>


</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ExtractBase.success"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.success">[docs]</a>  <span class="k">def</span> <span class="nf">success</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Checks that VASP run has completed.</span>

<span class="sd">        At this point, checks for the existence of OUTCAR.</span>
<span class="sd">        Then checks that timing stuff is present at end of OUTCAR.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="s">r&quot;&quot;&quot;General\s+timing\s+and\s+accounting\s+informations\s+for\s+this\s+job&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_last_OUTCAR</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">return</span> <span class="bp">False</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ExtractBase.iterTimes"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.iterTimes">[docs]</a>  <span class="k">def</span> <span class="nf">iterTimes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns a list of pairs: [[cpuTime,realTime], ...]</span>
<span class="sd">    from lines like::</span>

<span class="sd">         LOOP+:  cpu time   22.49: real time   24.43</span>

<span class="sd">    or sometimes like::</span>

<span class="sd">         LOOP+:  VPU time   42.93: CPU time   43.04</span>
<span class="sd">         In this case &quot;CPU&quot; is wall time, and &quot;VPU&quot; is CPU.</span>
<span class="sd">         See: http://cms.mpi.univie.ac.at/vasp-forum/forum_viewtopic.php?3.336</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">re</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
      <span class="s">r&#39;^\s*LOOP\+:\s+\w+\s+time\s+([.0-9]+):\s+\w+\s+time\s+([.0-9]+)\s*$&#39;</span><span class="p">)</span>
    <span class="n">tlist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__outcar__</span><span class="p">()</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span> <span class="n">lines</span> <span class="o">=</span> <span class="nb">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
      <span class="n">mat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span> <span class="n">regex</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">mat</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">cpuTime</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">mat</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">realTime</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">mat</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">tlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">[</span><span class="n">cpuTime</span><span class="p">,</span> <span class="n">realTime</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">tlist</span>




</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.datetime"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.datetime">[docs]</a>  <span class="k">def</span> <span class="nf">datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps execution date and time. &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="s">r&quot;&quot;&quot;executed on .*\n&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;date&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s">&#39;%Y.%m.</span><span class="si">%d</span><span class="s">  %H:%M:%S&#39;</span><span class="p">)</span>

</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ExtractBase.initial_structure"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.initial_structure">[docs]</a>  <span class="k">def</span> <span class="nf">initial_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Structure at start of calculations. &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="nb">compile</span><span class="p">,</span> <span class="n">M</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span><span class="p">,</span> <span class="n">dot</span>
    <span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">inv</span>
    <span class="kn">from</span> <span class="nn">...crystal</span> <span class="kn">import</span> <span class="n">Structure</span>
    <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">exec_input</span>
    <span class="kn">from</span> <span class="nn">pylada.misc</span> <span class="kn">import</span> <span class="n">bugLev</span>

    <span class="c"># nomodoutcar</span>
    <span class="c">#try:</span>
    <span class="c">#  regex = compile(&#39;#+ INITIAL STRUCTURE #+\n((.|\n)*)\n#+ END INITIAL STRUCTURE #+&#39;)</span>
    <span class="c">#  result = None</span>
    <span class="c">#  with self.__outcar__() as file:</span>
    <span class="c">#    result = regex.search(file.read(), M)</span>
    <span class="c">#  if bugLev &gt;= 5:</span>
    <span class="c">#    print &#39;vasp/extract/base: initial_structure: result: &#39;, result</span>
    <span class="c">#  if result is not None: return exec_input(result.group(1)).structure</span>
    <span class="c">#except: pass</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">Structure</span><span class="p">()</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__outcar__</span><span class="p">()</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
      <span class="n">atom_index</span><span class="p">,</span> <span class="n">cell_index</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>
      <span class="n">cell_re</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;^\s*direct\s+lattice\s+vectors\s+&quot;&quot;&quot;</span><span class="p">)</span>
      <span class="n">atom_re</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;^\s*position\s+of\s+ions\s+in\s+fractional\s+coordinates&quot;&quot;&quot;</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cell_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="k">break</span>
      <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">file</span><span class="o">.</span><span class="n">next</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span> <span class="n">result</span><span class="o">.</span><span class="n">cell</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;float64&#39;</span><span class="p">)</span>
      <span class="k">except</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span> <span class="n">result</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">3</span><span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;float64&#39;</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">cell</span> <span class="o">=</span> <span class="n">inv</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">cell</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">atom_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="k">break</span>
      <span class="k">for</span> <span class="n">specie</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">stoichiometry</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="nb">file</span><span class="p">):</span>
          <span class="n">data</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
          <span class="n">result</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">dot</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">cell</span><span class="p">,</span> <span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;float64&#39;</span><span class="p">)),</span> <span class="nb">type</span><span class="o">=</span><span class="n">specie</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>

  <span class="c"># nomodoutcar</span>
  <span class="c">#@property</span>
  <span class="c">#def _catted_contcar(self):</span>
  <span class="c">#  &quot;&quot;&quot; Returns contcar found at end of OUTCAR. &quot;&quot;&quot;</span>
  <span class="c">#  from re import compile</span>
  <span class="c">#  from StringIO import StringIO</span>
  <span class="c">#  from ...crystal import read</span>
  <span class="c">#  with self.__outcar__() as file: lines = file.readlines()</span>
  <span class="c">#  begin_contcar_re = compile(r&quot;&quot;&quot;#+\s+CONTCAR\s+#+&quot;&quot;&quot;)</span>
  <span class="c">#  end_contcar_re = compile(r&quot;&quot;&quot;#+\s+END\s+CONTCAR\s+#+&quot;&quot;&quot;)</span>
  <span class="c">#  start, end = None, None</span>
  <span class="c">#  for i, line in enumerate(lines[::-1]):</span>
  <span class="c">#    if begin_contcar_re.match(line) is not None: start = -i; break;</span>
  <span class="c">#    if end_contcar_re.match(line) is not None: end = -i</span>
  <span class="c">#  if start is None or end is None:</span>
  <span class="c">#    raise IOError(&quot;Could not find catted contcar.&quot;)</span>
  <span class="c">#  stringio = StringIO(&quot;&quot;.join(lines[start:end if end != 0 else -1]))</span>
  <span class="c">#  return read.poscar(stringio, self.species)</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
  <span class="k">def</span> <span class="nf">_grep_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps cell and positions from OUTCAR. &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="nb">compile</span>
    <span class="kn">from</span> <span class="nn">...crystal</span> <span class="kn">import</span> <span class="n">Structure</span>
    <span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">inv</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>

    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__outcar__</span><span class="p">()</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span> <span class="n">lines</span> <span class="o">=</span> <span class="nb">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">atom_index</span><span class="p">,</span> <span class="n">cell_index</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>
    <span class="n">atom_re</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;^\s*POSITION\s+&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="n">cell_re</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;^\s*direct\s+lattice\s+vectors\s+&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
      <span class="k">if</span> <span class="n">atom_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">atom_index</span> <span class="o">=</span> <span class="n">index</span> <span class="o">-</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="n">cell_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">cell_index</span> <span class="o">=</span> <span class="n">index</span><span class="p">;</span> <span class="k">break</span>
    <span class="k">if</span> <span class="n">atom_index</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">cell_index</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not find structure description in OUTCAR.&quot;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">Structure</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">result</span><span class="o">.</span><span class="n">cell</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="n">cell_index</span><span class="o">+</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&quot;float64&quot;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span> <span class="n">result</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="n">cell_index</span><span class="o">+</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">3</span><span class="p">:],</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&quot;float64&quot;</span><span class="p">)</span>
      <span class="n">result</span><span class="o">.</span><span class="n">cell</span> <span class="o">=</span> <span class="n">inv</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">cell</span><span class="p">)</span>
    <span class="c"># Get list like [&#39;S&#39;, &#39;S&#39;, &#39;S&#39;, &#39;S&#39;, &#39;S&#39;, &#39;S&#39;, &#39;Fe&#39;, &#39;Fe&#39;]</span>
    <span class="n">species</span> <span class="o">=</span> <span class="p">[</span><span class="nb">type</span> <span class="k">for</span> <span class="nb">type</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stoichiometry</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
    <span class="k">while</span> <span class="n">atom_index</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="n">atom_index</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
      <span class="n">result</span><span class="o">.</span><span class="n">add_atom</span><span class="p">(</span> <span class="n">pos</span><span class="o">=</span><span class="n">array</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="n">atom_index</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&quot;float64&quot;</span><span class="p">),</span>
                       <span class="nb">type</span><span class="o">=</span><span class="n">species</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span>
      <span class="n">atom_index</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">result</span>

  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
  <span class="k">def</span> <span class="nf">structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">pylada.misc</span> <span class="kn">import</span> <span class="n">bugLev</span>

    <span class="sd">&quot;&quot;&quot; Greps structure and total energy from OUTCAR. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">bugLev</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&#39;vasp/extract/base: structure: nsw: </span><span class="si">%s</span><span class="s">  ibrion: </span><span class="si">%s</span><span class="s">&#39;</span> \
        <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nsw</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibrion</span><span class="p">,)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nsw</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">ibrion</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_structure</span>

    <span class="k">try</span><span class="p">:</span> <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contcar_structure</span>
    <span class="k">except</span><span class="p">:</span>
      <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_grep_structure</span>
    <span class="k">if</span> <span class="n">bugLev</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&#39;vasp/extract/base: structure: result: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">result</span><span class="p">,)</span>

    <span class="c"># tries to find adequate name for structure.</span>
    <span class="k">try</span><span class="p">:</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span>
    <span class="k">except</span> <span class="n">GrepError</span><span class="p">:</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;POSCAR created by SUPERPOSCAR&#39;</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span> <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span>
      <span class="k">except</span> <span class="n">GrepError</span><span class="p">:</span> <span class="n">title</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">title</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">if</span> <span class="n">bugLev</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&#39;vasp/extract/base: structure: name: </span><span class="si">%s</span><span class="s">  result.name: </span><span class="si">%s</span><span class="s">&#39;</span> \
        <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">name</span><span class="p">,)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_energy</span>

    <span class="k">try</span><span class="p">:</span> <span class="n">initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_structure</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">initial</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span> <span class="nb">setattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">initial</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
          <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span> <span class="nb">setattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">bugLev</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&#39;vasp/extract/base: structure: initial: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">initial</span><span class="p">,)</span>

    <span class="c"># adds magnetization.</span>
    <span class="k">try</span><span class="p">:</span> <span class="n">magnetization</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">magnetization</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">magnetization</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">atom</span><span class="p">,</span> <span class="n">mag</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">magnetization</span><span class="p">):</span> <span class="n">atom</span><span class="o">.</span><span class="n">magmom</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">mag</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">bugLev</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&#39;vasp/extract/base: structure: magnetization: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">magnetization</span><span class="p">,)</span>

    <span class="c"># adds stress.</span>
    <span class="k">try</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">stress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stress</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
    <span class="c"># adds forces.</span>
    <span class="k">try</span><span class="p">:</span> <span class="n">forces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forces</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">force</span><span class="p">,</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">forces</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span> <span class="n">atom</span><span class="o">.</span><span class="n">force</span> <span class="o">=</span> <span class="n">force</span>
    <span class="k">return</span> <span class="n">result</span>

  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.LDAUType"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.LDAUType">[docs]</a>  <span class="k">def</span> <span class="nf">LDAUType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Type of LDA+U performed. &quot;&quot;&quot;</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;LDAUTYPE\s*=\s*(\d+)&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">type</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="s">&quot;liechtenstein&quot;</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="k">return</span> <span class="s">&quot;dudarev&quot;</span>
    <span class="k">return</span> <span class="nb">type</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.HubbardU_NLEP"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.HubbardU_NLEP">[docs]</a>  <span class="k">def</span> <span class="nf">HubbardU_NLEP</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Hubbard U/NLEP parameters. &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">..specie</span> <span class="kn">import</span> <span class="n">U</span> <span class="k">as</span> <span class="n">ldaU</span><span class="p">,</span> <span class="n">nlep</span>
    <span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="n">M</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;LDAUTYPE\s*=\s*(\d+)&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="p">{}</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">type</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

    <span class="n">species</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span> <span class="n">u</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;VRHFIN\s*=\s*(\S+)\s*:&quot;&quot;&quot;</span><span class="p">)</span> <span class="p">])</span>

    <span class="c"># first look for standard VASP parameters.</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="s">r&quot;&quot;&quot;\s*((?:(?:\+|-)?\d+(?:\.\d+)?\s*)+)\s*\n&quot;&quot;&quot;</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="s">r&quot;&quot;&quot;\s*angular\s+momentum\s+for\s+each\s+species\s+LDAUL\s+=&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">groups</span> \
          <span class="o">+</span> <span class="s">r&quot;&quot;&quot;\s*U\s+\(eV\)\s+for\s+each\s+species\s+LDAUU\s+=&quot;&quot;&quot;</span>         <span class="o">+</span> <span class="n">groups</span> \
          <span class="o">+</span> <span class="s">r&quot;&quot;&quot;\s*J\s+\(eV\)\s+for\s+each\s+species\s+LDAUJ\s+=&quot;&quot;&quot;</span>         <span class="o">+</span> <span class="n">groups</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">species</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">found</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_OUTCAR</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
      <span class="n">moment</span> <span class="o">=</span> <span class="n">found</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
      <span class="n">LDAU</span>   <span class="o">=</span> <span class="n">found</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
      <span class="n">LDAJ</span>   <span class="o">=</span> <span class="n">found</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
      <span class="k">for</span> <span class="n">specie</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">J</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">moment</span><span class="p">,</span> <span class="n">LDAU</span><span class="p">,</span> <span class="n">LDAJ</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="n">specie</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ldaU</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">U</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">J</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">del</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="n">result</span>

    <span class="c"># then look for nlep parameters.</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="s">r&quot;&quot;&quot;\s*angular\s+momentum\s+for\s+each\s+species,\s+LDAU#\s*(?:\d+)\s*:\s*L\s*=&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">groups</span> \
          <span class="o">+</span> <span class="s">r&quot;&quot;&quot;\s*U\s+\(eV\)\s+for\s+each\s+species,\s+LDAU\#\s*(?:\d+)\s*:\s*U\s*=&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">groups</span> \
          <span class="o">+</span> <span class="s">r&quot;&quot;&quot;\s*J\s+\(eV\)\s+for\s+each\s+species,\s+LDAU\#\s*(?:\d+)\s*:\s*J\s*=&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">groups</span> \
          <span class="o">+</span> <span class="s">r&quot;&quot;&quot;\s*nlep\s+for\s+each\s+species,\s+LDAU\#\s*(?:\d+)\s*:\s*O\s*=&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">groups</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">species</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">found</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_OUTCAR</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
      <span class="n">moment</span> <span class="o">=</span> <span class="n">found</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
      <span class="n">LDAU</span>   <span class="o">=</span> <span class="n">found</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
      <span class="n">LDAJ</span>   <span class="o">=</span> <span class="n">found</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
      <span class="n">funcs</span>  <span class="o">=</span> <span class="n">found</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
      <span class="k">for</span> <span class="n">specie</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">func</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">moment</span><span class="p">,</span> <span class="n">LDAU</span><span class="p">,</span> <span class="n">LDAJ</span><span class="p">,</span> <span class="n">funcs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="k">continue</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">func</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="n">specie</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ldaU</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">U</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">J</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="n">specie</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nlep</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">U</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">J</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">del</span> <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.pseudopotential"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.pseudopotential">[docs]</a>  <span class="k">def</span> <span class="nf">pseudopotential</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Title of the first POTCAR. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;POTCAR:.*&quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>

</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.volume"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.volume">[docs]</a>  <span class="k">def</span> <span class="nf">volume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Unit-cell volume. &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="nb">abs</span>
    <span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">det</span>
    <span class="kn">from</span> <span class="nn">quantities</span> <span class="kn">import</span> <span class="n">angstrom</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">det</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">scale</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">cell</span><span class="p">))</span> <span class="o">*</span> <span class="n">angstrom</span><span class="o">**</span><span class="mi">3</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.reciprocal_volume"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.reciprocal_volume">[docs]</a>  <span class="k">def</span> <span class="nf">reciprocal_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Reciprocal space volume (including 2pi). &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="nb">abs</span><span class="p">,</span> <span class="n">pi</span>
    <span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">det</span><span class="p">,</span> <span class="n">inv</span>
    <span class="kn">from</span> <span class="nn">quantities</span> <span class="kn">import</span> <span class="n">angstrom</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">det</span><span class="p">(</span><span class="n">inv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">scale</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">cell</span><span class="p">)))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2e0</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="n">angstrom</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.density"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.density">[docs]</a>  <span class="k">def</span> <span class="nf">density</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Computes density of the material. &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">quantities</span> <span class="kn">import</span> <span class="n">atomic_mass_unit</span> <span class="k">as</span> <span class="n">amu</span>
    <span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">periodic_table</span> <span class="k">as</span> <span class="n">pt</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mf">0e0</span> <span class="o">*</span> <span class="n">amu</span><span class="p">;</span>
    <span class="k">for</span> <span class="n">atom</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stoichiometry</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">atom</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pt</span><span class="o">.</span><span class="n">__dict__</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span><span class="p">;</span>
      <span class="n">result</span> <span class="o">+=</span> <span class="n">pt</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span><span class="o">.</span><span class="n">atomic_weight</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">amu</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">result</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">volume</span><span class="p">)</span><span class="o">.</span><span class="n">rescale</span><span class="p">(</span><span class="n">g</span><span class="o">/</span><span class="n">cm</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
  <span class="k">def</span> <span class="nf">_contcar_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps structure from CONTCAR. &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">...crystal</span> <span class="kn">import</span> <span class="n">read</span>
    <span class="kn">from</span> <span class="nn">quantities</span> <span class="kn">import</span> <span class="n">eV</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">poscar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__contcar__</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)</span>
    <span class="n">result</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_energy</span><span class="o">.</span><span class="n">rescale</span><span class="p">(</span><span class="n">eV</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span> <span class="k">else</span> <span class="mf">0e0</span>
    <span class="k">return</span> <span class="n">result</span>

  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.stoichiometry"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.stoichiometry">[docs]</a>  <span class="k">def</span> <span class="nf">stoichiometry</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Stoichiometry of the compound. &quot;&quot;&quot;</span>
    <span class="c"># Find line like:    ions per type =               2   4</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;\s*ions\s+per\s+type\s*=.*$&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">4</span><span class="p">:]]</span></div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ExtractBase.ions_per_specie"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.ions_per_specie">[docs]</a>  <span class="k">def</span> <span class="nf">ions_per_specie</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Alias for stoichiometry. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stoichiometry</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.species"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.species">[docs]</a>  <span class="k">def</span> <span class="nf">species</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps species from OUTCAR. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span> <span class="n">u</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;VRHFIN\s*=\s*(\S+)\s*:&quot;&quot;&quot;</span><span class="p">)</span> <span class="p">]</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.isif"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.isif">[docs]</a>  <span class="k">def</span> <span class="nf">isif</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps ISIF from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;\s*ISIF\s*=\s*(-?\d+)\s+&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.nsw"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.nsw">[docs]</a>  <span class="k">def</span> <span class="nf">nsw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps NSW from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;\s*NSW\s*=\s*(-?\d+)\s+&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.ismear"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.ismear">[docs]</a>  <span class="k">def</span> <span class="nf">ismear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps smearing function from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;\s*ISMEAR\s*=\s*(\d+);&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span>  <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.sigma"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.sigma">[docs]</a>  <span class="k">def</span> <span class="nf">sigma</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps smearing function from OUTCAR. &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="kn">from</span> <span class="nn">quantities</span> <span class="kn">import</span> <span class="n">eV</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;\s*ISMEAR\s*=\s*(?:\d+)\s*;\s*SIGMA\s*=\s+(.*)\s+br&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span>  <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">eV</span>
    <span class="k">return</span> <span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&quot;float64&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="n">eV</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ExtractBase.relaxation"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.relaxation">[docs]</a>  <span class="k">def</span> <span class="nf">relaxation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns the kind of relaxation performed in this calculation. &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">..keywords</span> <span class="kn">import</span> <span class="n">Relaxation</span>
    <span class="k">return</span> <span class="n">Relaxation</span><span class="p">()</span><span class="o">.</span><span class="n">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.ibrion"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.ibrion">[docs]</a>  <span class="k">def</span> <span class="nf">ibrion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps IBRION from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;\s*IBRION\s*=\s*(-?\d+)\s+&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.potim"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.potim">[docs]</a>  <span class="k">def</span> <span class="nf">potim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps POTIM from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;\s*POTIM\s*=\s*(-?\S+)\s+&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.lorbit"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.lorbit">[docs]</a>  <span class="k">def</span> <span class="nf">lorbit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps LORBIT from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;\s*LORBIT\s*=\s*(\d+)\s+&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.isym"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.isym">[docs]</a>  <span class="k">def</span> <span class="nf">isym</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps ISYM from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;\s*ISYM\s*=\s*(\d+)\s+&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.nupdown"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.nupdown">[docs]</a>  <span class="k">def</span> <span class="nf">nupdown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps NUPDOWN from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;\s*NUPDOWN\s*=\s*(\S+)\s+&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.lmaxmix"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.lmaxmix">[docs]</a>  <span class="k">def</span> <span class="nf">lmaxmix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps LMAXMIX from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;\s*LMAXMIX\s*=\s*(\d+)\s+&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.lvhar"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.lvhar">[docs]</a>  <span class="k">def</span> <span class="nf">lvhar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps LVHAR from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;\s*LVHAR\s*=\s*(\d+)\s+&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.istart"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.istart">[docs]</a>  <span class="k">def</span> <span class="nf">istart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps ISTART from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;\s*ISTART\s*=\s*(\d+)\s+&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.icharg"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.icharg">[docs]</a>  <span class="k">def</span> <span class="nf">icharg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps ICHARG from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;\s*ICHARG\s*=\s*(\d+)\s+&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.precision"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.precision">[docs]</a>  <span class="k">def</span> <span class="nf">precision</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps PREC from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;\s*PREC\s*=\s*(\S*)\s+&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s">&quot;accura&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="s">&quot;accurate&quot;</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.ediff"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.ediff">[docs]</a>  <span class="k">def</span> <span class="nf">ediff</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps EDIFF from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;\s*EDIFF\s*=\s*(\S+)\s+&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.ediffg"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.ediffg">[docs]</a>  <span class="k">def</span> <span class="nf">ediffg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps EDIFFG from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;\s*EDIFFG\s*=\s*(\S+)\s+&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.lsorbit"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.lsorbit">[docs]</a>  <span class="k">def</span> <span class="nf">lsorbit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps LSORBIT from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;\s*LSORBIT\s*=\s*(T|F)\s+&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;T&#39;</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.lasph"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.lasph">[docs]</a>  <span class="k">def</span> <span class="nf">lasph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps LASPH from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;\s*LASPH\s*=\s*(T|F)\s+&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;T&#39;</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.metagga"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.metagga">[docs]</a>  <span class="k">def</span> <span class="nf">metagga</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps METAGGA from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;\s*METAGGA\s*=\s*(T|F)\s+&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;T&#39;</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.lreal"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.lreal">[docs]</a>  <span class="k">def</span> <span class="nf">lreal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps LREAL from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;\s*LREAL\s*=\s*(T|F)\s+&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;T&#39;</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.lcompat"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.lcompat">[docs]</a>  <span class="k">def</span> <span class="nf">lcompat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps LCOMPAT from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;\s*LCOMPAT\s*=\s*(T|F)\s+&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;T&#39;</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.lreal_compat"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.lreal_compat">[docs]</a>  <span class="k">def</span> <span class="nf">lreal_compat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps LREAL_COMPAT from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;\s*LREAL_COMPAT\s*=\s*(T|F)\s+&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;T&#39;</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.lgga_compat"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.lgga_compat">[docs]</a>  <span class="k">def</span> <span class="nf">lgga_compat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps LGGA_COMPAT from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;\s*LGGA_COMPAT\s*=\s*(T|F)\s+&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;T&#39;</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.lcorr"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.lcorr">[docs]</a>  <span class="k">def</span> <span class="nf">lcorr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps LCORR from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;\s*LCORR\s*=\s*(T|F)\s+&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;T&#39;</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.ldiag"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.ldiag">[docs]</a>  <span class="k">def</span> <span class="nf">ldiag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps LDIAG from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;\s*LDIAG\s*=\s*(T|F)\s+&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;T&#39;</span>

</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.kpoints"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.kpoints">[docs]</a>  <span class="k">def</span> <span class="nf">kpoints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps k-points from OUTCAR.</span>

<span class="sd">        Numpy array where each row is a k-vector in cartesian units.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="nb">compile</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">found_generated</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;Found\s+(\d+)\s+irreducible\s+k-points&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="n">found_read</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;k-points in units of 2pi/SCALE and weight&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__outcar__</span><span class="p">()</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
      <span class="n">found</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">found_generated</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">found</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="k">break</span>
        <span class="k">elif</span> <span class="n">found_read</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">found</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="k">break</span>
      <span class="k">if</span> <span class="n">found</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">found</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;Following\s+cartesian\s+coordinates:&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">found</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="k">break</span>
        <span class="nb">file</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
          <span class="n">data</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
          <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span> <span class="k">break</span><span class="p">;</span>
          <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">data</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&quot;float64&quot;</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">found</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
          <span class="n">data</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
          <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">break</span>
          <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&quot;float64&quot;</span><span class="p">)</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.multiplicity"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.multiplicity">[docs]</a>  <span class="k">def</span> <span class="nf">multiplicity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps multiplicity of each k-point from OUTCAR. &quot;&quot;&quot;</span>
    <span class="c"># If generated kpoints,</span>
    <span class="c"># get the &quot;weight&quot; field from the cartesion part of a section like:</span>
    <span class="c">#   Found     10 irreducible k-points:</span>
    <span class="c">#   Following reciprocal coordinates:</span>
    <span class="c">#              Coordinates               Weight</span>
    <span class="c">#    0.000000  0.000000  0.000000      1.000000</span>
    <span class="c">#    0.250000  0.000000  0.000000      2.000000</span>
    <span class="c">#    ...</span>
    <span class="c">#   Following cartesian coordinates:</span>
    <span class="c">#              Coordinates               Weight</span>
    <span class="c">#    0.000000  0.000000  0.000000      1.000000</span>
    <span class="c">#    0.079365  0.045821  0.000000      2.000000</span>
    <span class="c">#    ...</span>
    <span class="c"># If specified kpoints,</span>
    <span class="c"># get the &quot;weight&quot; field from a section like:</span>
    <span class="c">#   k-points in units of 2pi/SCALE and weight: Automatic mesh</span>
    <span class="c">#     0.00000000  0.00000000  0.00000000       0.016</span>
    <span class="c">#     0.00000000  0.25000000  0.25000000       0.188</span>
    <span class="c">#     ...</span>

    <span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="nb">compile</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c"># case where kpoints where generated by vasp.</span>
    <span class="n">found_generated</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;Found\s+(\d+)\s+irreducible\s+k-points&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="c"># case where kpoints where given by hand.</span>
    <span class="n">found_read</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;k-points in units of 2pi/SCALE and weight&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__outcar__</span><span class="p">()</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
      <span class="n">found</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">found_generated</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">found</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="k">break</span>
        <span class="k">elif</span> <span class="n">found_read</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">found</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="k">break</span>
      <span class="k">if</span> <span class="n">found</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">found</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;Following\s+cartesian\s+coordinates:&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">found</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="k">break</span>
        <span class="nb">file</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
          <span class="n">data</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
          <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span> <span class="k">break</span><span class="p">;</span>
          <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&quot;float64&quot;</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">found</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
          <span class="n">data</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
          <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">break</span>
          <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">array</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)))</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">result</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&quot;float64&quot;</span><span class="p">)</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.ispin"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.ispin">[docs]</a>  <span class="k">def</span> <span class="nf">ispin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps ISPIN from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;^\s*ISPIN\s*=\s*(1|2)\s+&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not extract ISPIN from OUTCAR.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.name"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.name">[docs]</a>  <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps POSCAR title from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;^\s*POSCAR\s*=.*$&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not extract POSCAR title from OUTCAR.&quot;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.system"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.system">[docs]</a>  <span class="k">def</span> <span class="nf">system</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps system title from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;^\s*SYSTEM\s*=.*$&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not extract SYSTEM title from OUTCAR.&quot;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;&quot;&#39;</span><span class="p">:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;&quot;&#39;</span><span class="p">:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span>
</div>
  <span class="k">def</span> <span class="nf">_unpolarized_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">which</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns spin-unpolarized eigenvalues and occupations. &quot;&quot;&quot;</span>
    <span class="c"># which = 1: select eigenvalues</span>
    <span class="c"># which = 2: select occupations</span>
    <span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="nb">compile</span><span class="p">,</span> <span class="n">finditer</span>
    <span class="kn">import</span> <span class="nn">re</span>

    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__outcar__</span><span class="p">()</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span> <span class="n">lines</span> <span class="o">=</span> <span class="nb">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="c"># Finds last first kpoint.</span>
    <span class="n">spin_comp1_re</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="s">r&quot;\s*k-point\s+1\s*:\s*(\S+)\s+(\S+)\s+(\S+)\s*&quot;</span><span class="p">)</span>
    <span class="n">found</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
      <span class="n">found</span> <span class="o">=</span> <span class="n">spin_comp1_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">found</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="k">break</span>
    <span class="k">if</span> <span class="n">found</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not extract eigenvalues/occupation from OUTCAR.&quot;</span><span class="p">)</span>

    <span class="c"># Here i is the distance from file end of the last line like:</span>
    <span class="c">#  k-point   1 :       0.0000    0.0000    0.0000</span>
    <span class="k">if</span> <span class="n">bugLev</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&quot;vasp/ext/base: unpolarized_vals: is_dft: </span><span class="si">%s</span><span class="s">  i: </span><span class="si">%d</span><span class="s">  line: </span><span class="si">%s</span><span class="s">&quot;</span> \
        <span class="o">%</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span><span class="p">,)</span>

    <span class="c"># now greps actual results.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span>
      <span class="n">kp_re</span> <span class="o">=</span> <span class="s">r&quot;\s*k-point\s+(?:(?:\d|\*)+)\s*:\s*(?:\S+)\s*(?:\S+)\s*(?:\S+)\n&quot;</span>\
              <span class="s">r&quot;\s*band\s+No\.\s+band\s+energies\s+occupation\s*\n&quot;</span>\
              <span class="s">r&quot;(\s*(?:\d+)\s+(?:\S+)\s+(?:\S+)\s*\n)+&quot;</span>
      <span class="n">skip</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">kp_re</span> <span class="o">=</span> <span class="s">r&quot;\s*k-point\s+(?:(?:\d|\*)+)\s*:\s*(?:\S+)\s*(?:\S+)\s*(?:\S+)\n&quot;</span>\
              <span class="s">r&quot;\s*band\s+No\.\s+.*\n\n&quot;</span>\
              <span class="s">r&quot;(\s*(?:\d+)\s+(?:\S+)\s+(?:\S+)\s+(?:\S+)\s+(?:\S+)&quot;</span>\
              <span class="s">r&quot;\s+(?:\S+)\s+(?:\S+)\s+(?:\S+)\s*\n)+&quot;</span>
      <span class="n">skip</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">8</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">kp</span> <span class="ow">in</span> <span class="n">finditer</span><span class="p">(</span><span class="n">kp_re</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">:]),</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="p">):</span>
      <span class="c"># Each iteration is a k-point.</span>
      <span class="c"># dummy is a list of sublists, one sublist per OUTCAR line, like:</span>
      <span class="c">#   [[&#39;1&#39;, &#39;-30.5498&#39;, &#39;2.00000&#39;],</span>
      <span class="c">#    [&#39;2&#39;, &#39;-30.5497&#39;, &#39;2.00000&#39;],</span>
      <span class="c">#    [&#39;3&#39;, &#39;-30.3889&#39;, &#39;2.00000&#39;],</span>
      <span class="c">#    [&#39;4&#39;, &#39;-30.3889&#39;, &#39;2.00000&#39;],</span>
      <span class="c">#    [&#39;5&#39;, &#39;-30.3857&#39;, &#39;2.00000&#39;],</span>
      <span class="c">#    ...</span>
      <span class="c">#    [&#39;28&#39;, &#39;7.5661&#39;, &#39;0.00000&#39;],</span>
      <span class="c">#    [], []]</span>
      <span class="c"># We only process those elements having len == cols (here, 3).</span>
      <span class="c"># We append the &quot;which&quot; column value to results.</span>

      <span class="n">dummy</span> <span class="o">=</span> <span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">kp</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)[</span><span class="n">skip</span><span class="p">:]]</span>
      <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">which</span><span class="p">])</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">dummy</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">==</span> <span class="n">cols</span><span class="p">])</span>

    <span class="c"># results is a list of sublists, one sublist per k-point,</span>
    <span class="c"># containing the band energies:</span>
    <span class="c">#  [[-30.5498, -30.5497, -30.3889, -30.3889, ...],</span>
    <span class="c">#   [-30.5371, -30.5371, -30.4543, -30.4542, ...],</span>
    <span class="c">#   ...</span>
    <span class="c">#   [-30.6596, -30.6596, -30.4905, -30.4905, ...],</span>
    <span class="c">#   [-30.6604, -30.6603, -30.4906, -30.4906, ...]]</span>
    <span class="k">if</span> <span class="n">bugLev</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&quot;vasp/ext/base: unpolarized_vals: results: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">results</span><span class="p">,)</span>
    <span class="k">return</span> <span class="n">results</span>

  <span class="k">def</span> <span class="nf">_spin_polarized_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">which</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns spin-polarized eigenvalues and occupations. &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="nb">compile</span><span class="p">,</span> <span class="n">finditer</span>
    <span class="kn">import</span> <span class="nn">re</span>

    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__outcar__</span><span class="p">()</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span> <span class="n">lines</span> <span class="o">=</span> <span class="nb">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="c"># Finds last spin components.</span>
    <span class="n">spin_comp1_re</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;\s*spin\s+component\s+(1|2)\s*$&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="n">spins</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
      <span class="n">found</span> <span class="o">=</span> <span class="n">spin_comp1_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">found</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">continue</span>
      <span class="k">if</span> <span class="n">found</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;1&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">spins</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
          <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not find two spin components in OUTCAR.&quot;</span><span class="p">)</span>
        <span class="n">spins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
        <span class="k">break</span>
      <span class="k">else</span><span class="p">:</span>  <span class="n">spins</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
    <span class="k">if</span> <span class="n">spins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">spins</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not extract eigenvalues/occupation from OUTCAR.&quot;</span><span class="p">)</span>

    <span class="c"># now greps actual results.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span>
      <span class="n">kp_re</span> <span class="o">=</span> <span class="s">r&quot;\s*k-point\s+(?:(?:\d|\*)+)\s*:\s*(?:\S+)\s*(?:\S+)\s*(?:\S+)\n&quot;</span>\
              <span class="s">r&quot;\s*band\s+No\.\s+band\s+energies\s+occupation\s*\n&quot;</span>\
              <span class="s">r&quot;(\s*(?:\d+)\s+(?:\S+)\s+(?:\S+)\s*\n)+&quot;</span>
      <span class="n">skip</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">kp_re</span> <span class="o">=</span> <span class="s">r&quot;\s*k-point\s+(?:(?:\d|\*)+)\s*:\s*(?:\S+)\s*(?:\S+)\s*(?:\S+)\n&quot;</span>\
              <span class="s">r&quot;\s*band\s+No\.\s+.*\n\n&quot;</span>\
              <span class="s">r&quot;(\s*(?:\d+)\s+(?:\S+)\s+(?:\S+)\s+(?:\S+)\s+(?:\S+)&quot;</span>\
              <span class="s">r&quot;\s+(?:\S+)\s+(?:\S+)\s+(?:\S+)\s*\n)+&quot;</span>
      <span class="n">skip</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">8</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[],</span> <span class="p">[]</span> <span class="p">]</span>
    <span class="k">for</span> <span class="n">kp</span> <span class="ow">in</span> <span class="n">finditer</span><span class="p">(</span><span class="n">kp_re</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="n">spins</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">spins</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="p">):</span>
      <span class="n">dummy</span> <span class="o">=</span> <span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">kp</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)[</span><span class="n">skip</span><span class="p">:]]</span>
      <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">which</span><span class="p">])</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">dummy</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">==</span> <span class="n">cols</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">kp</span> <span class="ow">in</span> <span class="n">finditer</span><span class="p">(</span><span class="n">kp_re</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="n">spins</span><span class="p">[</span><span class="mi">1</span><span class="p">]:]),</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="p">):</span>
      <span class="n">dummy</span> <span class="o">=</span> <span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">kp</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)[</span><span class="n">skip</span><span class="p">:]]</span>
      <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">u</span><span class="p">[</span><span class="n">which</span><span class="p">]</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">dummy</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">==</span> <span class="n">cols</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">results</span>

  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.ionic_charges"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.ionic_charges">[docs]</a>  <span class="k">def</span> <span class="nf">ionic_charges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps ionic_charges from OUTCAR.&quot;&quot;&quot;</span>
    <span class="c"># Line like:    ZVAL   =  12.00  6.00</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;^\s*ZVAL\s*=\s*(.*)$&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_last_OUTCAR</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not find ionic_charges in OUTCAR&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.valence"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.valence">[docs]</a>  <span class="k">def</span> <span class="nf">valence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps number of valence bands from OUTCAR.&quot;&quot;&quot;</span>
    <span class="n">ionic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ionic_charges</span>
    <span class="n">species</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span>
    <span class="n">atoms</span> <span class="o">=</span> <span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">type</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="p">]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c"># ionic is like: [12.0, 6.0]</span>
    <span class="c"># species is like: [&#39;Mo&#39;, &#39;S&#39;]</span>
    <span class="k">if</span> <span class="n">bugLev</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&quot;vasp/ext/base: valence: ionic:&quot;</span><span class="p">,</span> <span class="n">ionic</span>
      <span class="k">print</span> <span class="s">&quot;vasp/ext/base: valence: species:&quot;</span><span class="p">,</span> <span class="n">species</span>
    <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ionic</span><span class="p">,</span> <span class="n">species</span><span class="p">):</span> <span class="n">result</span> <span class="o">+=</span> <span class="n">c</span> <span class="o">*</span> <span class="n">atoms</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.nelect"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.nelect">[docs]</a>  <span class="k">def</span> <span class="nf">nelect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps nelect from OUTCAR.&quot;&quot;&quot;</span>
    <span class="c"># Find line like:    NELECT =      48.0000    total number of electrons</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;^\s*NELECT\s*=\s*(\S+)\s+total\s+number\s+of\s+electrons\s*$&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_last_OUTCAR</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not find energy in OUTCAR&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ExtractBase.extraelectron"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.extraelectron">[docs]</a>  <span class="k">def</span> <span class="nf">extraelectron</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns charge state of the system. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nelect</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">valence</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ExtractBase.nonscf"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.nonscf">[docs]</a>  <span class="k">def</span> <span class="nf">nonscf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; True if non-selfconsistent calculation. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">icharg</span> <span class="o">&gt;=</span> <span class="mi">10</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ExtractBase.lwave"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.lwave">[docs]</a>  <span class="k">def</span> <span class="nf">lwave</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps LWAVE from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;^\s*LWAVE\s*=\s*(\S)&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;T&#39;</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ExtractBase.lcharg"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.lcharg">[docs]</a>  <span class="k">def</span> <span class="nf">lcharg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps LWAVE from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;^\s*LCHARG\s*=\s*(\S)&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;T&#39;</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ExtractBase.lnoncollinear"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.lnoncollinear">[docs]</a>  <span class="k">def</span> <span class="nf">lnoncollinear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps LNONCOLLINEAR from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;^\s*LNONCOLLINEAR\s*=\s*(\S)&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;T&#39;</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ExtractBase.lsecvar"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.lsecvar">[docs]</a>  <span class="k">def</span> <span class="nf">lsecvar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps LSECVAR from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;^\s*LSECVAR\s*=\s*(\S)&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;T&#39;</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ExtractBase.lelf"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.lelf">[docs]</a>  <span class="k">def</span> <span class="nf">lelf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps LELF from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;^\s*LELF\s*=\s*(\S)&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;T&#39;</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ExtractBase.ldipol"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.ldipol">[docs]</a>  <span class="k">def</span> <span class="nf">ldipol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps LDIPOL from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;^\s*LDIPOL\s*=\s*(\S)&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;T&#39;</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ExtractBase.lvtot"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.lvtot">[docs]</a>  <span class="k">def</span> <span class="nf">lvtot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps LVTOT from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;^\s*LVTOT\s*=\s*(\S)&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;T&#39;</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ExtractBase.nelm"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.nelm">[docs]</a>  <span class="k">def</span> <span class="nf">nelm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps NELM from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;^\s*NELM\s*=\s*(\d+)&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ExtractBase.nelmdl"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.nelmdl">[docs]</a>  <span class="k">def</span> <span class="nf">nelmdl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps NELMDL from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="s">r&quot;&quot;&quot;^\s*NELM\s*=\s*\d+\s*;&quot;&quot;&quot;</span>\
             <span class="sd">&quot;&quot;&quot;\s*NELMIN\s*=\s*\d+\s*;&quot;&quot;&quot;</span>\
             <span class="sd">&quot;&quot;&quot;\s*NELMDL\s*=\s*(-?\d+)&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ExtractBase.nelmin"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.nelmin">[docs]</a>  <span class="k">def</span> <span class="nf">nelmin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps NELMIN from OUTCAR. &quot;&quot;&quot;</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="s">r&quot;&quot;&quot;^\s*NELM\s*=\s*\d+\s*;\s*NELMIN\s*=\s*(\d+)&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.nbands"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.nbands">[docs]</a>  <span class="k">def</span> <span class="nf">nbands</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Number of bands in calculation. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">&quot;&quot;&quot;NBANDS\s*=\s*(\d+)&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not find NBANDS in OUTCAR.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.nbprocs"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.nbprocs">[docs]</a>  <span class="k">def</span> <span class="nf">nbprocs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Number of bands in calculation. &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_first_OUTCAR</span><span class="p">(</span><span class="s">&quot;&quot;&quot;running\s+on\s+(\d+)\s+nodes&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not find number of processes in OUTCAR.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="ExtractBase.iterfiles"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.iterfiles">[docs]</a>  <span class="k">def</span> <span class="nf">iterfiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; iterates over input/output files.</span>

<span class="sd">        :param bool stout: Include standard output files</span>
<span class="sd">        :param bool errors: Include stderr files.</span>
<span class="sd">        :param bool input: Include INCAR file</span>
<span class="sd">        :param bool wavefunctions: Include WAVECAR file</span>
<span class="sd">        :param bool dos: Include DOSCAR file</span>
<span class="sd">        :param bool charge: Include CHGCAR file</span>
<span class="sd">        :param bool structure: Include POSCAR file</span>
<span class="sd">        :param bool contcar: Include CONTCAR file</span>
<span class="sd">        :param bool procar: Include PROCAR file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">exists</span><span class="p">,</span> <span class="n">join</span>
    <span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">iglob</span>
    <span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">OUTCAR</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;stdout&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span> <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;stdout&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;errors&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span> <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;stderr&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;input&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>  <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;INCAR&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;wavefunctions&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span> <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;WAVECAR&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;dos&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>  <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;DOSCAR&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;charge&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>  <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;CHGCAR&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;structure&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>  <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;POSCAR&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;contcar&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span> <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;CONTCAR&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;procar&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span> <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;PROCAR&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
      <span class="nb">file</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">exists</span><span class="p">(</span><span class="nb">file</span><span class="p">):</span> <span class="k">yield</span> <span class="nb">file</span>
    <span class="c"># Add RelaxCellShape directories.</span>
    <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">(</span> <span class="n">iglob</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="s">&quot;relax_cellshape/[0-9]/&quot;</span><span class="p">)),</span>
                      <span class="n">iglob</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="s">&quot;relax_cellshape/[0-9][0-9]/&quot;</span><span class="p">)),</span>
                      <span class="n">iglob</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="s">&quot;relax_ions/[0-9]/&quot;</span><span class="p">)),</span>
                      <span class="n">iglob</span><span class="p">(</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="s">&quot;relax_ions/[0-9][0-9]/&quot;</span><span class="p">))</span> <span class="p">):</span>
      <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
      <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">iterfiles</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="k">yield</span> <span class="nb">file</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.energy_sigma0"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.energy_sigma0">[docs]</a>  <span class="k">def</span> <span class="nf">energy_sigma0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps total energy extrapolated to $\sigma=0$ from OUTCAR. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a DFT calculation.&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">quantities</span> <span class="kn">import</span> <span class="n">eV</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;energy\s+without\s+entropy\s*=\s*(\S+)\s+energy\(sigma-&gt;0\)\s+=\s+(\S+)&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_last_OUTCAR</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not find sigma0 energy in OUTCAR&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">eV</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.energies_sigma0"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.energies_sigma0">[docs]</a>  <span class="k">def</span> <span class="nf">energies_sigma0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps total energy extrapolated to $\sigma=0$ from OUTCAR. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a DFT calculation.&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="kn">from</span> <span class="nn">quantities</span> <span class="kn">import</span> <span class="n">eV</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;energy\s+without\s+entropy\s*=\s*(\S+)\s+energy\(sigma-&gt;0\)\s+=\s+(\S+)&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span> <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_OUTCAR</span><span class="p">(</span><span class="n">regex</span><span class="p">)]</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span> <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not find energies in OUTCAR&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not find energy in OUTCAR&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">*</span> <span class="n">eV</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.all_total_energies"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.all_total_energies">[docs]</a>  <span class="k">def</span> <span class="nf">all_total_energies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps total energies for all electronic steps from OUTCAR.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a DFT calculation.&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="kn">from</span> <span class="nn">quantities</span> <span class="kn">import</span> <span class="n">eV</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;energy\s+without\s+entropy =\s*(\S+)\s+energy\(sigma-&gt;0\)\s+=\s+(\S+)&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span> <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_OUTCAR</span><span class="p">(</span><span class="n">regex</span><span class="p">)]</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span> <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not find energies in OUTCAR&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not find energy in OUTCAR&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">*</span> <span class="n">eV</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ExtractBase.fermi0K"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.fermi0K">[docs]</a>  <span class="k">def</span> <span class="nf">fermi0K</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Fermi energy at zero kelvin.</span>

<span class="sd">        This procedure recomputes the fermi energy using a step-function.</span>
<span class="sd">        It avoids negative occupation numbers. As such, it may be different</span>
<span class="sd">        from the fermi energy given by vasp, depeneding on the smearing and the</span>
<span class="sd">        smearing function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a DFT calculation.&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">rollaxis</span><span class="p">,</span> <span class="nb">sum</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ispin</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="n">eigs</span> <span class="o">=</span> <span class="n">rollaxis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">eigs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span>
    <span class="k">if</span> <span class="n">bugLev</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&quot;vasp/ext/base: fermi0K: eigs:&quot;</span><span class="p">,</span> <span class="n">eigs</span>
      <span class="k">print</span> <span class="s">&quot;vasp/ext/base: fermi0K: multiplicity:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span>
    <span class="c"># eigs:</span>
    <span class="c">#   [[-30.5498 -30.5497 -30.3889 ...,   7.5536   7.5647   7.5661]</span>
    <span class="c">#    [-30.5371 -30.5371 -30.4543 ...,   7.3166   7.403    7.419 ]</span>
    <span class="c">#    [-30.5993 -30.5992 -30.5086 ...,   7.011    7.0944   7.3217]</span>
    <span class="c">#    ...,</span>
    <span class="c">#    [-30.7117 -30.7117 -30.4854 ...,   6.9983   7.368    7.3682]</span>
    <span class="c">#    [-30.6596 -30.6596 -30.4905 ...,   6.885    7.3079   7.308 ]</span>
    <span class="c">#    [-30.6604 -30.6603 -30.4906 ...,   6.885    7.3096   7.3097]]</span>
    <span class="c"># Multiplicity:</span>
    <span class="c">#   [ 1.  2.  2.  2.  2.  2.  2.  2.  2.  ...  2.  2.  2.  2.  2.]</span>

    <span class="c"># Make array = a list of pairs replicating each multiplicity</span>
    <span class="c"># for all the eigvals of the given kpoint.</span>
    <span class="c"># If there are K kpoints and N eigvals per kpoint,</span>
    <span class="c"># and the multiplicities are m0, m1, ..., m[K-1],</span>
    <span class="c"># then array is:</span>
    <span class="c">#   [</span>
    <span class="c">#    (eigs[0,0],m0), (eigs[0,1],m0), ... (eigs[0,N-1],m0),</span>
    <span class="c">#    (eigs[1,0],m1), (eigs[1,1],m1), ... (eigs[1,N-1],m1),</span>
    <span class="c">#    (eigs[2,0],m2), (eigs[2,1],m2), ... (eigs[2,N-1],m2),</span>
    <span class="c">#    ...</span>
    <span class="c">#    (eigs[K-1,0],m[K-1]), (eigs[K-1,1],m[K-1]), ... (eigs[K-1,N-1],m[K-1])</span>
    <span class="c">#   ]</span>
    <span class="c">#</span>
    <span class="c"># The zip below is an array of pairs like:</span>
    <span class="c">#   [(array([-30.5498, -30.5497, -30.3889, ... 7.5647, 7.5661]) * eV, 1.0),</span>
    <span class="c">#    (array([-30.5371, -30.5371, -30.4543, ... 7.403 , 7.419 ]) * eV, 2.0),</span>
    <span class="c">#    ...</span>
    <span class="c">#    (array([-30.6604, -30.6603, -30.4906, ... 7.3096, 7.3097]) * eV, 2.0)]</span>

    <span class="n">array</span> <span class="o">=</span> <span class="p">[(</span><span class="n">e</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">eigs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">u</span><span class="o">.</span><span class="n">flat</span><span class="p">]</span>
    <span class="c">#if bugLev &gt;= 5:</span>
    <span class="c">#  print &quot;vasp/ext/base: fermi0K: unsorted array:&quot;, array</span>

    <span class="c"># Sort by increasing eig</span>
    <span class="n">array</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

    <span class="c"># Work through the list of sorted pairs accumulating</span>
    <span class="c">#   occ += multiplicity * factor</span>
    <span class="c"># where factor = 1 / sum(multiplicity)</span>
    <span class="c"># When occ &gt;= valence quit: that eigval is the fermi0K.</span>

    <span class="n">occ</span> <span class="o">=</span> <span class="mf">0e0</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ispin</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">1.0</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">bugLev</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&quot;vasp/ext/base: ispin: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ispin</span>
      <span class="k">print</span> <span class="s">&quot;vasp/ext/base: sum(mult): &quot;</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multiplicity</span><span class="p">)</span>
      <span class="c">#print &quot;vasp/ext/base: fermi0K: sorted array:&quot;, array</span>
      <span class="k">print</span> <span class="s">&quot;vasp/ext/base: fermi0K: factor:&quot;</span><span class="p">,</span> <span class="n">factor</span>
      <span class="k">print</span> <span class="s">&quot;vasp/ext/base: fermi0K: valence: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valence</span><span class="p">,)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
      <span class="n">occ</span> <span class="o">+=</span> <span class="n">w</span><span class="o">*</span><span class="n">factor</span>
      <span class="k">if</span> <span class="n">occ</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valence</span> <span class="o">-</span> <span class="mf">1e-8</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">bugLev</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
          <span class="k">print</span> <span class="s">&quot;vasp/ext/base: fermi0K: found i: </span><span class="si">%s</span><span class="s">  e: </span><span class="si">%s</span><span class="s">  w: </span><span class="si">%s</span><span class="s">  occ: </span><span class="si">%s</span><span class="s">&quot;</span> \
            <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">occ</span><span class="p">,)</span>
        <span class="k">return</span> <span class="n">e</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span><span class="o">.</span><span class="n">units</span>
    <span class="k">return</span> <span class="bp">None</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ExtractBase.halfmetallic"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.halfmetallic">[docs]</a>  <span class="k">def</span> <span class="nf">halfmetallic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; True if the material is half-metallic. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a DFT calculation.&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="nb">max</span><span class="p">,</span> <span class="nb">abs</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ispin</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="bp">False</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbm</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vbm</span> <span class="o">&gt;</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbm</span><span class="o">.</span><span class="n">units</span><span class="p">:</span> <span class="k">return</span> <span class="bp">False</span>

    <span class="n">fermi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fermi0K</span>
    <span class="n">vbm0</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;=</span><span class="nb">float</span><span class="p">(</span><span class="n">fermi</span><span class="p">)</span><span class="o">+</span><span class="mf">1e-8</span><span class="p">])</span>
    <span class="n">vbm1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;=</span><span class="nb">float</span><span class="p">(</span><span class="n">fermi</span><span class="p">)</span><span class="o">+</span><span class="mf">1e-8</span><span class="p">])</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">vbm0</span><span class="o">-</span><span class="n">vbm1</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">2e0</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">fermi</span> <span class="o">-</span> <span class="n">vbm0</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">fermi</span> <span class="o">-</span> <span class="n">vbm1</span><span class="p">))</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ExtractBase.cbm"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.cbm">[docs]</a>  <span class="k">def</span> <span class="nf">cbm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns Condunction Band Minimum. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a DFT calculation.&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="nb">min</span>
    <span class="k">if</span> <span class="n">bugLev</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&quot;vasp/ext/base: cbm: eigvals:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span>
      <span class="k">print</span> <span class="s">&quot;vasp/ext/base: cbm: fermi a:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fermi0K</span>
      <span class="k">print</span> <span class="s">&quot;vasp/ext/base: cbm: fermi units:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fermi0K</span><span class="o">.</span><span class="n">units</span>
      <span class="k">print</span> <span class="s">&quot;vasp/ext/base: cbm: fermi b:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fermi0K</span><span class="o">+</span><span class="mf">1e-8</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fermi0K</span><span class="o">.</span><span class="n">units</span>
    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">fermi0K</span><span class="o">+</span><span class="mf">1e-8</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fermi0K</span><span class="o">.</span><span class="n">units</span><span class="p">])</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ExtractBase.vbm"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.vbm">[docs]</a>  <span class="k">def</span> <span class="nf">vbm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns Valence Band Maximum. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a DFT calculation.&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="nb">max</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span><span class="o">&lt;=</span><span class="bp">self</span><span class="o">.</span><span class="n">fermi0K</span><span class="o">+</span><span class="mf">1e-8</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fermi0K</span><span class="o">.</span><span class="n">units</span><span class="p">])</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.total_energies"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.total_energies">[docs]</a>  <span class="k">def</span> <span class="nf">total_energies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps total energies for all ionic steps from OUTCAR.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a DFT calculation.&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="kn">from</span> <span class="nn">quantities</span> <span class="kn">import</span> <span class="n">eV</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;energy\s+without\s+entropy=\s*(\S+)\s+energy\(sigma-&gt;0\)\s+=\s+(\S+)&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span> <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_OUTCAR</span><span class="p">(</span><span class="n">regex</span><span class="p">)]</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span> <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not find energies in OUTCAR&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not find energy in OUTCAR&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">*</span> <span class="n">eV</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.total_energy"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.total_energy">[docs]</a>  <span class="k">def</span> <span class="nf">total_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps total energy from OUTCAR.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a DFT calculation.&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">quantities</span> <span class="kn">import</span> <span class="n">eV</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;energy\s+without\s+entropy=\s*(\S+)\s+energy\(sigma-&gt;0\)\s+=\s+(\S+)&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_last_OUTCAR</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not find energy in OUTCAR&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">eV</span>
</div>
  <span class="n">energy</span> <span class="o">=</span> <span class="n">total_energy</span>
  <span class="sd">&quot;&quot;&quot; Alias for total_energy. &quot;&quot;&quot;</span>

  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.fermi_energy"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.fermi_energy">[docs]</a>  <span class="k">def</span> <span class="nf">fermi_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps fermi energy from OUTCAR. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a DFT calculation.&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">quantities</span> <span class="kn">import</span> <span class="n">eV</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="s">r&quot;&quot;&quot;E-fermi\s*:\s*(\S+)&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_last_OUTCAR</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not find fermi energy in OUTCAR&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">eV</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.moment"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.moment">[docs]</a>  <span class="k">def</span> <span class="nf">moment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns magnetic moment from OUTCAR. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a DFT calculation.&#39;</span><span class="p">)</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="s">r&quot;&quot;&quot;^\s*number\s+of\s+electron\s+(\S+)\s+magnetization\s+(\S+)\s*$&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_last_OUTCAR</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not find magnetic moment in OUTCAR&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.pressures"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.pressures">[docs]</a>  <span class="k">def</span> <span class="nf">pressures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps all pressures from OUTCAR &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a DFT calculation.&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">quantities</span> <span class="kn">import</span> <span class="n">kbar</span> <span class="k">as</span> <span class="n">kB</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="s">r&quot;&quot;&quot;external\s+pressure\s*=\s*(\S+)\s*kB\s+Pullay\s+stress\s*=\s*(\S+)\s*kB&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span> <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_OUTCAR</span><span class="p">(</span><span class="n">regex</span><span class="p">)]</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span> <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not find pressures in OUTCAR&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not find pressures in OUTCAR&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span> <span class="o">*</span> <span class="n">kB</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.pressure"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.pressure">[docs]</a>  <span class="k">def</span> <span class="nf">pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps last pressure from OUTCAR &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a DFT calculation.&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">quantities</span> <span class="kn">import</span> <span class="n">kbar</span> <span class="k">as</span> <span class="n">kB</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="s">r&quot;&quot;&quot;external\s+pressure\s*=\s*(\S+)\s*kB\s+Pullay\s+stress\s*=\s*(\S+)\s*kB&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_last_OUTCAR</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not find pressure in OUTCAR&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">kB</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.alphabet"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.alphabet">[docs]</a>  <span class="k">def</span> <span class="nf">alphabet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps alpha+bet from OUTCAR &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a DFT calculation.&#39;</span><span class="p">)</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="s">r&quot;&quot;&quot;^\s*E-fermi\s*:\s*(\S+)\s+XC\(G=0\)\s*:\s*(\S+)\s+alpha\+bet\s*:(\S+)\s*$&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_last_OUTCAR</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not find alpha+bet in OUTCAR&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.xc_g0"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.xc_g0">[docs]</a>  <span class="k">def</span> <span class="nf">xc_g0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps XC(G=0) from OUTCAR &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a DFT calculation.&#39;</span><span class="p">)</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="s">r&quot;&quot;&quot;^\s*E-fermi\s*:\s*(\S+)\s+XC\(G=0\)\s*:\s*(\S+)\s+alpha\+bet\s*:(\S+)\s*$&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_last_OUTCAR</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not find xc(G=0) in OUTCAR&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.pulay_pressure"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.pulay_pressure">[docs]</a>  <span class="k">def</span> <span class="nf">pulay_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps pressure from OUTCAR &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a DFT calculation.&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">quantities</span> <span class="kn">import</span> <span class="n">kbar</span> <span class="k">as</span> <span class="n">kB</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="s">r&quot;external\s+pressure\s*=\s*(\S+)\s*kB\s+&quot;</span>                        \
            <span class="s">r&quot;Pullay\s+stress\s*=\s*(\S+)\s*kB&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_last_OUTCAR</span><span class="p">(</span><span class="n">regex</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
     <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not find pulay pressure in OUTCAR&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">kB</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.fft"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.fft">[docs]</a>  <span class="k">def</span> <span class="nf">fft</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps recommended or actual fft setting from OUTCAR. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a DFT calculation.&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="n">search</span><span class="p">,</span> <span class="n">M</span> <span class="k">as</span> <span class="n">re_M</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="s">r&quot;(?!I would recommend the setting:\s*\n)&quot;</span>                         \
             <span class="s">&quot;\s*dimension x,y,z NGX =\s+(\d+)\s+NGY =\s+(\d+)\s+NGZ =\s+(\d+)&quot;</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__outcar__</span><span class="p">()</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">search</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="nb">file</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">re_M</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not FFT grid in OUTCAR.&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">array</span><span class="p">([</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span>
                   <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span>
                   <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="p">])</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.recommended_fft"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.recommended_fft">[docs]</a>  <span class="k">def</span> <span class="nf">recommended_fft</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps recommended or actual fft setting from OUTCAR. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a DFT calculation.&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="n">search</span><span class="p">,</span> <span class="n">M</span> <span class="k">as</span> <span class="n">re_M</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="s">r&quot;I would recommend the setting:\s*\n&quot;</span>                             \
             <span class="s">&quot;\s*dimension x,y,z NGX =\s+(\d+)\s+NGY =\s+(\d+)\s+NGZ =\s+(\d+)&quot;</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__outcar__</span><span class="p">()</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">search</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="nb">file</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">re_M</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not recommended FFT grid in OUTCAR.&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">array</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">))])</span>
</div>
  <span class="k">def</span> <span class="nf">_partial_charges_impl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grep</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps partial charges from OUTCAR.</span>

<span class="sd">        This is a numpy array where the first dimension is the ion (eg one row</span>
<span class="sd">        per ion), and the second the partial charges for each angular momentum.</span>
<span class="sd">        The total is not included. Implementation also used for magnetization.</span>

<span class="sd">        The OUTCAR looks like the following, although in some</span>
<span class="sd">        cases there may be an extra column for the f shell,</span>
<span class="sd">        or the d shell may be missing.</span>

<span class="sd">         total charge</span>

<span class="sd">        # of ion     s       p       d       tot</span>
<span class="sd">        ----------------------------------------</span>
<span class="sd">          1        0.288   0.363   6.223   6.874</span>
<span class="sd">          2        1.771   4.143   0.000   5.914</span>
<span class="sd">        ------------------------------------------------</span>
<span class="sd">        tot        2.059   4.506   6.223  12.788</span>

<span class="sd">         magnetization (x)</span>

<span class="sd">        # of ion     s       p       d       tot</span>
<span class="sd">        ----------------------------------------</span>
<span class="sd">          1       -0.017  -0.008  -1.935  -1.960</span>
<span class="sd">          2       -0.005  -0.006   0.000  -0.011</span>
<span class="sd">        ------------------------------------------------</span>
<span class="sd">        tot       -0.022  -0.014  -1.935  -1.970</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">re</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__outcar__</span><span class="p">()</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span> <span class="n">lines</span> <span class="o">=</span> <span class="nb">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">found</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">grep</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">found</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="n">index</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="k">break</span>
    <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="n">index</span> <span class="o">-=</span> <span class="mi">4</span>
    <span class="n">line_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;^\s*\d+((\s+\S+)+)\s*$&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
      <span class="n">match</span> <span class="o">=</span> <span class="n">line_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="n">index</span><span class="o">+</span><span class="n">i</span><span class="p">])</span>
      <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">break</span>
      <span class="n">stgs</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
      <span class="n">stgs</span> <span class="o">=</span> <span class="n">stgs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>     <span class="c"># omit the last column, &quot;tot&quot;</span>
      <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span> <span class="n">stg</span><span class="p">)</span> <span class="k">for</span> <span class="n">stg</span> <span class="ow">in</span> <span class="n">stgs</span><span class="p">]</span>
      <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">vals</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&quot;float64&quot;</span><span class="p">)</span>

  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.partial_charges"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.partial_charges">[docs]</a>  <span class="k">def</span> <span class="nf">partial_charges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps partial charges from OUTCAR.</span>

<span class="sd">        This is a numpy array where the first dimension is the ion (eg one row</span>
<span class="sd">        per ion), and the second the partial charges for each angular momentum.</span>
<span class="sd">        The total is not included.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a DFT calculation.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_partial_charges_impl</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;\s*total\s+charge\s*$&quot;&quot;&quot;</span><span class="p">)</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.magnetization"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.magnetization">[docs]</a>  <span class="k">def</span> <span class="nf">magnetization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps partial charges from OUTCAR.</span>

<span class="sd">        This is a numpy array where the first dimension is the ion (eg one row</span>
<span class="sd">        per ion), and the second the partial charges for each angular momentum.</span>
<span class="sd">        The total is not included.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a DFT calculation.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_partial_charges_impl</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;^\s*magnetization\s*\(x\)\s*$&quot;&quot;&quot;</span><span class="p">)</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.eigenvalues"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.eigenvalues">[docs]</a>  <span class="k">def</span> <span class="nf">eigenvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps eigenvalues from OUTCAR.</span>

<span class="sd">        In spin-polarized cases, the leading dimension of the numpy array are</span>
<span class="sd">        spins, followed by kpoints, and finally with bands. In spin-unpolarized</span>
<span class="sd">        cases, the leading dimension are the kpoints, followed by the bands.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_gw</span><span class="p">):</span>
      <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;Neither a DFT not a GW calculation.&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="kn">from</span> <span class="nn">quantities</span> <span class="kn">import</span> <span class="n">eV</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ispin</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_spin_polarized_values</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&quot;float64&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="n">eV</span>
    <span class="k">return</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_unpolarized_values</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&quot;float64&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="n">eV</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.occupations"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.occupations">[docs]</a>  <span class="k">def</span> <span class="nf">occupations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps occupations from OUTCAR.</span>

<span class="sd">        In spin-polarized cases, the leading dimension of the numpy array are</span>
<span class="sd">        spins, followed by kpoints, and finally with bands. In spin-unpolarized</span>
<span class="sd">        cases, the leading dimension are the kpoints, followed by the bands.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_gw</span><span class="p">):</span>
      <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;Neither a DFT not a GW calculation.&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ispin</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_spin_polarized_values</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&quot;float64&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_unpolarized_values</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&quot;float64&quot;</span><span class="p">)</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.qp_eigenvalues"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.qp_eigenvalues">[docs]</a>  <span class="k">def</span> <span class="nf">qp_eigenvalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps quasi-particle eigenvalues from OUTCAR.</span>

<span class="sd">        In spin-polarized cases, the leading dimension of the numpy array are</span>
<span class="sd">        spins, followed by kpoints, and finally with bands. In spin-unpolarized</span>
<span class="sd">        cases, the leading dimension are the kpoints, followed by the bands.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_gw</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a GW calculation.&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ispin</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_spin_polarized_values</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&quot;float64&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="n">eV</span>
    <span class="k">return</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_unpolarized_values</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&quot;float64&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="n">eV</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.self_energies"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.self_energies">[docs]</a>  <span class="k">def</span> <span class="nf">self_energies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps self-energies of each eigenvalue from OUTCAR.</span>

<span class="sd">        In spin-polarized cases, the leading dimension of the numpy array are</span>
<span class="sd">        spins, followed by kpoints, and finally with bands. In spin-unpolarized</span>
<span class="sd">        cases, the leading dimension are the kpoints, followed by the bands.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_gw</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a GW calculation.&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ispin</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_spin_polarized_values</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&quot;float64&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="n">eV</span>
    <span class="k">return</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_unpolarized_values</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&quot;float64&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="n">eV</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.electropot"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.electropot">[docs]</a>  <span class="k">def</span> <span class="nf">electropot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Greps average atomic electrostatic potentials from OUTCAR. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a DFT calculation.&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="nb">compile</span><span class="p">,</span> <span class="n">X</span> <span class="k">as</span> <span class="n">reX</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="kn">from</span> <span class="nn">quantities</span> <span class="kn">import</span> <span class="n">eV</span>

    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__outcar__</span><span class="p">()</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span> <span class="n">lines</span> <span class="o">=</span> <span class="nb">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span> <span class="s">r&quot;average\s+\(electrostatic\)\s+potential\s+at\s+core&quot;</span><span class="p">,</span>   \
                     <span class="n">reX</span> <span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
      <span class="k">if</span> <span class="n">regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="k">break</span>
    <span class="k">if</span> <span class="o">-</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
      <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&quot;Could not find average atomic potential in file.&quot;</span><span class="p">)</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;(?:\s|\d){8}\s*(-?\d+\.\d+)&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">:]:</span>
      <span class="n">data</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">break</span>
      <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">regex</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">line</span><span class="p">)])</span>

    <span class="k">return</span> <span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&quot;float64&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="n">eV</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.electronic_dielectric_constant"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.electronic_dielectric_constant">[docs]</a>  <span class="k">def</span> <span class="nf">electronic_dielectric_constant</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Electronic contribution to the dielectric constant. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a DFT calculation.&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="n">M</span> <span class="k">as</span> <span class="n">multline</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="s">r&quot;\s*MACROSCOPIC\s+STATIC\s+DIELECTRIC\s&quot;</span>                          \
               <span class="s">r&quot;+TENSOR\s*\(including local field effects in DFT\)\s*\n&quot;</span>      \
            <span class="s">r&quot;\s*-+\s*\n&quot;</span>                                                      \
            <span class="s">r&quot;\s*(\S+)\s+(\S+)\s+(\S+)\s*\n&quot;</span>                                   \
            <span class="s">r&quot;\s*(\S+)\s+(\S+)\s+(\S+)\s*\n&quot;</span>                                   \
            <span class="s">r&quot;\s*(\S+)\s+(\S+)\s+(\S+)\s*\n&quot;</span>                                   \
            <span class="s">r&quot;\s*-+\s*\n&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_last_OUTCAR</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">multline</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&#39;Could not find dielectric tensor in output.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">array</span><span class="p">(</span> <span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)],</span>                      \
                  <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;float64&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="p">)</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.ionic_dielectric_constant"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.ionic_dielectric_constant">[docs]</a>  <span class="k">def</span> <span class="nf">ionic_dielectric_constant</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Ionic contribution to the dielectric constant. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a DFT calculation.&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="n">M</span> <span class="k">as</span> <span class="n">multline</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="n">regex</span> <span class="o">=</span> <span class="s">r&quot;\s*MACROSCOPIC\s+STATIC\s+DIELECTRIC&quot;</span>                            \
              <span class="s">r&quot;\s+TENSOR\s+IONIC\s+CONTRIBUTION\s*\n&quot;</span>                         \
            <span class="s">r&quot;\s*-+\s*\n&quot;</span>                                                      \
            <span class="s">r&quot;\s*(\S+)\s+(\S+)\s+(\S+)\s*\n&quot;</span>                                   \
            <span class="s">r&quot;\s*(\S+)\s+(\S+)\s+(\S+)\s*\n&quot;</span>                                   \
            <span class="s">r&quot;\s*(\S+)\s+(\S+)\s+(\S+)\s*\n&quot;</span>                                   \
            <span class="s">r&quot;\s*-+\s*\n&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_last_OUTCAR</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">multline</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">raise</span> <span class="n">GrepError</span><span class="p">(</span><span class="s">&#39;Could not find dielectric tensor in output.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">array</span><span class="p">(</span> <span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)],</span>                      \
                  <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;float64&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="p">)</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ExtractBase.dielectric_constant"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.dielectric_constant">[docs]</a>  <span class="k">def</span> <span class="nf">dielectric_constant</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Dielectric constant of the material. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a DFT calculation.&#39;</span><span class="p">)</span>
    <span class="k">return</span>  <span class="bp">self</span><span class="o">.</span><span class="n">electronic_dielectric_constant</span>                                \
            <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ionic_dielectric_constant</span>

  <span class="c"># fixmod:</span>
  <span class="c"># Caution: I think the regex.group args below are incorrect.</span></div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.stresses"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.stresses">[docs]</a>  <span class="k">def</span> <span class="nf">stresses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns total stress at each relaxation step. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a DFT calculation.&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">zeros</span><span class="p">,</span> <span class="nb">abs</span><span class="p">,</span> <span class="n">array</span>
    <span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">det</span>
    <span class="kn">from</span> <span class="nn">quantities</span> <span class="kn">import</span> <span class="n">eV</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">kbar</span>
    <span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="n">finditer</span><span class="p">,</span> <span class="n">M</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isif</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="n">pattern</span>                                                                    \
      <span class="o">=</span> <span class="s">&quot;&quot;&quot;\s*Total\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s*</span><span class="se">\n</span><span class="s">&quot;&quot;&quot;</span>    \
        <span class="sd">&quot;&quot;&quot;\s*in kB\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s*\n&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__outcar__</span><span class="p">()</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">regex</span> <span class="ow">in</span> <span class="n">finditer</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="nb">file</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">M</span><span class="p">):</span>
        <span class="n">stress</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&quot;float64&quot;</span><span class="p">),</span> <span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&quot;float64&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
          <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span> <span class="n">stress</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">regex</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">j</span><span class="p">))</span>
          <span class="n">stress</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">regex</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">4</span><span class="p">))</span>
          <span class="n">stress</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">regex</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">4</span><span class="p">))</span>
          <span class="n">stress</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">regex</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">4</span><span class="p">))</span>  <span class="c"># should be: + 5</span>
          <span class="n">stress</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">regex</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">4</span><span class="p">))</span>  <span class="c"># should be: + 5</span>
          <span class="n">stress</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">regex</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">4</span><span class="p">))</span>  <span class="c"># should be: + 6</span>
          <span class="n">stress</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">regex</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">6</span><span class="o">+</span><span class="mi">4</span><span class="p">))</span>  <span class="c"># should be: + 6</span>
        <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">stress</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span> <span class="o">&gt;</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">stress</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())):</span>
          <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">stress</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">eV</span><span class="o">.</span><span class="n">rescale</span><span class="p">(</span><span class="n">J</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e22</span>                \
                         <span class="o">/</span> <span class="nb">abs</span><span class="p">(</span><span class="n">det</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">cell</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">scale</span><span class="p">)))</span> \
                         <span class="o">*</span> <span class="n">kbar</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stress</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">*</span><span class="n">kbar</span></div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ExtractBase.stress"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.stress">[docs]</a>  <span class="k">def</span> <span class="nf">stress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns final total stress. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a DFT calculation.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stresses</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.forces"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.forces">[docs]</a>  <span class="k">def</span> <span class="nf">forces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Forces on each atom. &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s">&#39;not a DFT calculation.&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="kn">from</span> <span class="nn">quantities</span> <span class="kn">import</span> <span class="n">angstrom</span><span class="p">,</span> <span class="n">eV</span>
    <span class="kn">from</span> <span class="nn">re</span> <span class="kn">import</span> <span class="n">finditer</span><span class="p">,</span> <span class="n">M</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot; *POSITION\s*TOTAL-FORCE\s*\(eV\/Angst\)\s*</span><span class="se">\n</span><span class="s">&quot;&quot;&quot;</span>              \
              <span class="sd">&quot;&quot;&quot;\s*-+\s*\n&quot;&quot;&quot;</span>                                                 \
              <span class="sd">&quot;&quot;&quot;(?:\s+\S+\s+\S+\s+\S+\s+\S+\s+\S+\s+\S+\s*\n)+&quot;&quot;&quot;</span>             \
              <span class="sd">&quot;&quot;&quot;\s*-+\s*\n&quot;&quot;&quot;</span>                                                 \
              <span class="sd">&quot;&quot;&quot;\s*total drift&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__outcar__</span><span class="p">()</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">regex</span> <span class="ow">in</span> <span class="n">finditer</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="nb">file</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">M</span><span class="p">):</span> <span class="k">pass</span>
    <span class="k">return</span> <span class="n">array</span><span class="p">(</span> <span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">3</span><span class="p">:]</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">regex</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]],</span>   \
                   <span class="n">dtype</span><span class="o">=</span><span class="s">&quot;float64&quot;</span> <span class="p">)</span> <span class="o">*</span> <span class="n">eV</span> <span class="o">/</span> <span class="n">angstrom</span>

</div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.errors"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.errors">[docs]</a>  <span class="k">def</span> <span class="nf">errors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; List of errors.</span>

<span class="sd">        Errors that are encountered more than once are not repeated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__outcar__</span><span class="p">()</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">&#39;ERROR&#39;</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">errors</span><span class="p">:</span>
          <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">errors</span></div>
  <span class="nd">@property</span>
  <span class="nd">@make_cached</span>
<div class="viewcode-block" id="ExtractBase.warnings"><a class="viewcode-back" href="../../../../pyapi/vasp/extractbase.html#pylada.vasp.extract.base.ExtractBase.warnings">[docs]</a>  <span class="k">def</span> <span class="nf">warnings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; List of warnings.</span>

<span class="sd">        Warnings that are encountered more than once are not repeated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__outcar__</span><span class="p">()</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">&#39;WARNING&#39;</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">warnings</span><span class="p">:</span>
          <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">warnings</span>
</div>
  <span class="k">def</span> <span class="nf">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Attributes and members of this class.</span>

<span class="sd">        Removes dft and gw attributes if this is not a dft or gw calculation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">u</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">)</span> <span class="k">if</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;_&#39;</span><span class="p">])</span>              \
             <span class="o">|</span> <span class="nb">set</span><span class="p">([</span><span class="n">u</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">()</span> <span class="k">if</span> <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;_&#39;</span> <span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_gw</span><span class="p">:</span>
      <span class="n">result</span> <span class="o">-=</span> <span class="nb">set</span><span class="p">([</span><span class="s">&#39;qp_eigenvalues&#39;</span><span class="p">,</span> <span class="s">&#39;self_energies&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dft</span><span class="p">:</span>
      <span class="n">result</span> <span class="o">-=</span> <span class="nb">set</span><span class="p">(</span> <span class="p">[</span> <span class="s">&#39;energy_sigma0&#39;</span><span class="p">,</span> <span class="s">&#39;energies_sigma0&#39;</span><span class="p">,</span>
		       <span class="s">&#39;all_total_energies&#39;</span><span class="p">,</span> <span class="s">&#39;fermi0K&#39;</span><span class="p">,</span> <span class="s">&#39;halfmetallic&#39;</span><span class="p">,</span> <span class="s">&#39;cbm&#39;</span><span class="p">,</span>
		       <span class="s">&#39;vbm&#39;</span><span class="p">,</span> <span class="s">&#39;total_energies&#39;</span><span class="p">,</span> <span class="s">&#39;total_energy&#39;</span><span class="p">,</span> <span class="s">&#39;fermi_energy&#39;</span><span class="p">,</span>
		       <span class="s">&#39;moment&#39;</span><span class="p">,</span> <span class="s">&#39;pressures&#39;</span><span class="p">,</span> <span class="s">&#39;pressure&#39;</span><span class="p">,</span> <span class="s">&#39;forces&#39;</span><span class="p">,</span> <span class="s">&#39;stresses&#39;</span><span class="p">,</span>
		       <span class="s">&#39;stress&#39;</span><span class="p">,</span> <span class="s">&#39;alphabet&#39;</span><span class="p">,</span> <span class="s">&#39;xc_g0&#39;</span><span class="p">,</span> <span class="s">&#39;pulay_pressure&#39;</span><span class="p">,</span> <span class="s">&#39;fft&#39;</span><span class="p">,</span>
		       <span class="s">&#39;recommended_fft&#39;</span><span class="p">,</span> <span class="s">&#39;partial_charges&#39;</span><span class="p">,</span> <span class="s">&#39;magnetization&#39;</span><span class="p">,</span>
		       <span class="s">&#39;electropot&#39;</span><span class="p">,</span> <span class="s">&#39;electronic_dielectric_constant&#39;</span><span class="p">,</span>
                       <span class="s">&#39;ionic_dielectric_constant&#39;</span><span class="p">,</span> <span class="s">&#39;dielectric_constant&#39;</span> <span class="p">]</span> <span class="p">)</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">Pylada-light 1.0 documentation</a> &raquo;</li>
          <li><a href="../../../index.html" >Module code</a> &raquo;</li>
          <li><a href="../../../pylada.html" >pylada</a> &raquo;</li>
          <li><a href="../../vasp.html" >pylada.vasp</a> &raquo;</li>
          <li><a href="../extract.html" >pylada.vasp.extract</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Mayeul d&#39;Avezac.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>